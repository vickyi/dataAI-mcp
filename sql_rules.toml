# SQL规则配置文件
# 使用TOML格式定义SQL检查规则

[general]
# 通用配置
sql_dialect = "hive"
enabled = true

[rules.select_star]
# 禁止使用 SELECT *
id = "R001"
enabled = true
level = "error"
description = "禁止使用 SELECT *，请明确列出所需字段"
message = "禁止使用 SELECT *，请明确列出所需字段"
exclude_functions = ["COUNT"]

[rules.partition_filter]
# 检查分区字段过滤
id = "R101"
enabled = true
level = "error"
description = "查询必须包含分区字段过滤条件，以避免全表扫描"
partition_fields = ["dt", "date"]
require_where_clause = true

[rules.table_alias]
# 检查表别名
id = "R002"
enabled = true
level = "warning"
description = "建议为表使用别名"

[rules.sensitive_columns]
# 检查敏感字段
id = "R301"
enabled = true
level = "error"
description = "查询中包含敏感字段，请确认是否有权限访问并已进行脱敏处理"
sensitive_keywords = [
    "phone",
    "email",
    "id_card",
    "password",
    "credit_card",
    "ssn",
    "bank_account",
    "salary"
]

[rules.field_alias_naming]
# 检查字段别名命名规范
id = "R201"
enabled = true
level = "warning"
description = "字段别名建议使用下划线命名法"
naming_pattern = "^[a-z]+(_[a-z]+)*$"
invalid_patterns = ["^[a-z]+[A-Z][a-z]*"]

[rules.join_conditions]
# 检查JOIN条件
id = "R401"
enabled = false  # 默认不启用
level = "warning"
description = "JOIN语句应该包含明确的连接条件，避免笛卡尔积"

[rules.query_complexity]
# 查询复杂度检查
id = "R501"
enabled = false  # 默认不启用
level = "warning"
description = "查询复杂度过高，建议简化"
max_joins = 5
max_subqueries = 3
max_tables = 10

[rules.index_usage]
# 索引使用检查
id = "R601"
enabled = false  # 默认不启用
level = "warning"
description = "WHERE子句中的字段建议有索引"

# 新增的Hive建表规则
[rules.hive_ddl_keywords]
# Hive DDL关键字规范检查
id = "R701"
enabled = true
level = "warning"
description = "Hive建表语句关键字应使用小写"
keywords = [
    "CREATE", "TABLE", "EXTERNAL", "PARTITIONED", "STORED", "LOCATION",
    "ROW", "FORMAT", "FIELDS", "TERMINATED", "COLLECTION", "ITEMS",
    "KEYS", "LINES", "TBLPROPERTIES"
]

[rules.hive_ddl_alignment]
# Hive DDL关键字对齐检查
id = "R702"
enabled = true
level = "warning"
description = "Hive建表语句关键字应对齐"
alignment_spaces = 4

[rules.hive_external_table]
# Hive外表检查
id = "R703"
enabled = true
level = "error"
description = "Hive建表语句应使用EXTERNAL关键字创建外表"